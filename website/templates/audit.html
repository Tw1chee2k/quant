{% extends "base.html" %}
{% block title %}Проверка отчетов{% endblock %}
{% block content %}

<div class="report-area_page">
    <div class="report-area_menu">
        <div class="report-area_podmenu">
            <input type="radio" id="tab1" name="tab-group" class = "report-area_menu-input" checked>
            <label for="tab1" class="report-area_menu-name">Панель управления</label>
            <div class="content-podmenu">
                <nav>
                    <ul>
                        <section>
                            <div class="functions_menu">
                                <form id="new-report-form" action="/create_new_report" method="POST" style="display: none;">
                                </form>
                                <li id="create-report-btn" >
                                    <img src="{{ url_for('static', filename='img/icon_new_file.png') }}" alt="Создать отчет">
                                    <a>Добавить</a>
                                </li>
                            </div>
                            <a class="functions_menu_name">
                                Отчет
                            </a>
                        </section>
                        <section>
                            <div class="functions_menu">
                                <li>
                                    <img src="{{ url_for('static', filename='img/icon_excel.png') }}" alt="">
                                    <a>Экспорт</a>
                                </li>

                                <li id="control_versionButton">
                                    <img src="{{ url_for('static', filename='img/icon_control.png') }}" alt="">
                                    <a>Контроль</a>
                                </li>

                                    <form id="control-version-form" action="/control_version" method="POST" style="display: none;">
                                    </form>
                        
                                <li id = "agreedVersionButton">
                                    <img src="{{ url_for('static', filename='img/icon_galochka.png') }}" alt="">
                                    <a>Согласовать</a>
                                </li>
                                    <form id="agreed-version-form" action="/agreed_version" method="POST" style="display: none;">
                                    </form>
                                <li id = "sentVersionButton">
                                    <img src="{{ url_for('static', filename='img/icon_send.png') }}" alt="">
                                    <a>Отправить</a>
                                </li>
                                    <form id="sent-version-form" action="/sent_version" method="POST" style="display: none;">
                                    </form>
                            </div>
                            <a class="functions_menu_name">
                                Версия отчета
                            </a>
                        </section>
                        <section>
                            <div class="functions_menu">
                                <li onclick="openNewWindow('/report')">
                                    <img src="{{ url_for('static', filename='img/icon_print_file.png') }}" alt="">
                                    <a>Печать</a>
                                </li>
                            </div>
                            <a class="functions_menu_name">
                                Квитанция
                            </a>
                        </section>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    <div class="report-area" style = "margin-top: 180px;">
        {%if report%}
        <table class="table_report-area">
            <thead class="order-table_titels">
                <tr>
                    <th></th>
                    <th></th>
                    <th style = "display: none;">ID</th>
                    <th>ОКПО</th>
                    <th style="white-space: nowrap;">Наименование предприятия</th>
                    <th>Год</th>
                    <th>Квартал</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                    {% for row in report %}
                    <tr class="report_row" data-id="{{ row.id }}">
                        <td></td>
                        <td>
                            <button class="show-versions_button">  
                                <img src="{{ url_for('static', filename='img/close_white.png')}}" class = "close_white" alt="">
                                <img src="{{ url_for('static', filename='img/close_black.png')}}" class = "close_black" alt="">
                            </button>
                        </td>
                        <td style = "display: none;">
                            <input type = "text" id = "report_id" style = "text-align:center;" value = "{{ row.id }}" readonly>
                        </td>
                        <td>
                            <input type = "text" id = "report_okpo" style = "text-align:center;" value = "{{ row.okpo }}" readonly>
                        </td>
                        <td>
                            <input type = "text" id = "report_organization_name" value = "{{ row.organization_name }}" readonly>
                        </td>
                        <td>
                            <input type = "text" id = "report_year" style = "text-align:center;" value = "{{ row.year }}" readonly>
                        </td>
                        <td>
                            <input type = "text" id = "report_quarter" style = "text-align:center;" value = "{{ row.quarter }}" readonly>
                        </td>
                        <td>

                        </td>
                    </tr>
                    <tr class="change_input_row">
                        <td colspan="10">
                            <form action="/update_report" method="POST">
                                <div class="change_input">
                                    <div class="placehold_of_left">ОКПО</div>
                                    <input type="text" name="okpo" value="{{ row.okpo }}" style="border: 1px solid #3333;" readonly>
                                </div>
                                <div class="change_input">
                                    <div class="placehold_of_left">Год</div>
                                    <input type="text" name="year" value="{{ row.year }}" style="border: 1px solid #3333;" placeholder="Год">
                                </div>
                                <div class="change_input">
                                    <div class="placehold_of_left">Квартал</div>
                                    <input type="text" name="quarter" value="{{ row.quarter }}" style="border: 1px solid #3333;" placeholder="Квартал">
                                </div>
                                <input type="hidden" name="id" value="{{ row.id }}" placeholder="id">
                                <button type="submit">Обновить</button>
                            </form>
                        </td>
                    </tr>
                    <tr class="versions_row" >
                        <td colspan="10" class="vers_cont">
                            <div class="text_vers">--Версии--</div>
                            <table class="table-versions">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Дата начала</th>
                                        <th>Дата изменения</th>
                                        <th>Контроль</th>
                                        <th>Согласовано</th>
                                        <th>Отправлено</th>
                                        <th>Дата согласования</th>
                                        <th>ФИО</th>
                                        <th>Телефон</th>
                                        <th>Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for rows in row.versions %}
                                    <tr class="version-row" data-id="{{ rows.id }}">
                                        <td>
                                            <button class="show-cheks_button">  
                                                <img src="{{ url_for('static', filename='img/close_white.png')}}" class = "close_white" alt="">
                                                <img src="{{ url_for('static', filename='img/close_black.png')}}" class = "close_black" alt="">
                                            </button>
                                            
                                        </td>
                                        <td>
                                            <input type = "text" value = "{{ rows.begin_time}}" readonly>
                                        </td>
                                        <td>
                                            {% if rows.change_time %}
                                            <input type = "text" value = "{{ rows.change_time }}" readonly>
                                            {% else %}
                                            &nbsp;
                                            {% endif %}
                                        </td>
                                        <td>
                                            <input type="checkbox" name="control" {% if rows.control %} checked {% endif %} >
                                        </td>
                                        <td>
                                            <input type="checkbox" name="agreed" {% if rows.agreed %} checked {% endif %} >
                                        </td>
                                        <td>
                                            <input type="checkbox" name="sent" {% if rows.sent %} checked {% endif %} >
                                        </td>
                                        <td>
                                            {% if rows.agreed_time %}
                                            <input type = "text" value = "{{ rows.agreed_time }}" readonly>
                                            {% else %}
                                            &nbsp;
                                            {% endif %}
                                        </td>
                                        <td>
                                            <input type = "text" value = "{{ rows.fio }}" readonly>
                                        </td> 
                                        <td>
                                            <input type = "text" value = "{{ rows.telephone }}" readonly>
                                        </td> 
                                        <td>
                                            <input type = "text" value = "{{ rows.email }}" readonly>
                                        </td> 
                                    </tr>
                                    <tr class="check_row">
                                        <td colspan="10" class = "check_cont">
                                            <div class="text_cheks">--Квитанции--</div>
                                            <table class="cheks_table">
                                                <thead>
                                                    <tr>
                                                        <th>Дата выдачи</th>
                                                        <th>Успех</th>
                                                        <th>Описание</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {%if tickets%}  
                                                        {% for tickets in ticket %}
                                                        <tr class="row_with_cheks">
                                                            <td>
                                                                <input type = "text" value = "{{ tickets.begin_time }}" readonly>
                                                            </td>
                                                            <td>
                                                                <input type = "text" value = "{{ tickets.luck }}" readonly>
                                                            </td>
                                                            <td>
                                                                <input type = "text" value = "{{ tickets.note }}" readonly>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    {%else%}
                                                    <tr class="row_with_cheks">
                                                        <td colspan="3">
                                                            <input type = "text" style = "margin: 3px;" value = "Нет данных" readonly>
                                                        </td>
                                                    </tr>
                                                    
                                                    {%endif%}
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    {% endfor %}

            </tbody>
        </table>
    {%else%}
        <h3 style = "margin-left: 30px;">
            Для начала работы создайте новый отчет
        </h3>
    {%endif%}
    </div>
</div>

<div id="change_report_modal" class="modal">
    <div class="modal-content">
        <div class = "modal-header">
            <h3 class = "change-position">Редактирование отчета</h3>
            <a class="close">&times;</a>
        </div>
        <form method="POST" action="/update_report">
            <table class="change-report_table">      
                <tr>
                    <td>Наименование предприятия</td>
                    <td>
                        <input 
                            type="text" 
                            name="modal_organization_name" 
                            id="modal_organization_name" 
                            style = "width: 200px; text-align: left; color: rgb(132,132,132);" 
                            autocomplete="off" 
                            readonly
                        >
                    </td>
                </tr>
                <tr>
                    <td>ОКПО</td>
                    <td>
                        <input 
                            type="text"
                            name="modal_report_okpo" 
                            id="modal_report_okpo" 
                            style = "color: rgb(132,132,132);" 
                            autocomplete="off" 
                            readonly
                        >
                    </td>
                </tr>
                <tr>
                    <td>Год</td>
                    <td>
                        <select 
                            name="modal_report_year" 
                            id="modal_report_year" 
                            readonly
                        >
                            <option>2024</option>
                            <option>2025</option>
                            <option>2026</option>
                            <option>2027</option>
                        </select>

                    </td>
                </tr>
                <tr>
                    <td>Квартал</td>
                    <td>
                        <select 
                            name="modal_report_quarter" 
                            id="modal_report_quarter"
                            readonly
                        >
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                        </select>

                        <input 
                            type="hidden" 
                            name="modal_report_id" 
                            id="modal_report_id"
                        >
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td style = "text-align: right;">
                        <button type="submit" class="blue_button report-submit">Изменить</button >
                    </td>
                </tr>
            </table>
       
        </form> 
    </div>
</div>

<div id="contextMenu_report" class="white-panel">
    <button id = "link_change_report">
        <span>Редактировать</span>
    </button>
    <form id="addVersion" method="POST" action="/create_new_report_version/">
        <button type="submit" id="add_versionButton">
            <span>Добавить версию</span>
        </button>
    </form>
    <form id="deleteReport" method="POST" action="/delete_report/">
        <button type="submit" id="del_reportButton">
            <span>Удалить</span>
        </button>
    </form>
</div>


<div id="contextMenu_version" class="white-panel">
    <button data-action="checkVersionButton">
        <span>Изменить данные</span>
    </button>
    <form id="deleteVersion" method="POST" action="/delete_version/">
        <button type="submit" id="del_versionButton">
            <span>Удалить</span>
        </button>
    </form>
</div>



<script>

</script>
{% endblock %}
