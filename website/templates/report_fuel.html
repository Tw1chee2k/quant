{% extends "base.html" %}
{% block title %}Fuel rep:{{curent_report}}; vers:{{current_version}} {% endblock %}
{% block content %}
<div class = "report-area_page">
    <div class = "report-area_menu">
        <div class="report-area_podmenu">
            <input type="radio" id="tab1" name="tab-group" checked>
            <label for="tab1" class="report-area_menu-name">Панель управления</label> 
            <div class="content-podmenu">
                <nav>
                    <ul>
                        <section>
                            <div class = "functions_menu">
                                <li id = "">
                                    <img src="{{ url_for('static', filename='img/icon_new_file.png')}}" alt="">
                                    <a>Добавить</a>
                                </li>
                                <li>
                                    <img src="{{ url_for('static', filename='img/icon_delete_file.png')}}" alt="">
                                    <a>Удалить</a>
                                </li>
                                <li>                     
                                    <img src="{{ url_for('static', filename='img/.png')}}" alt="">
                                    <a>Изменить</a>
                                </li>
                            </div>
                            <div style = "font-weight: 600;">
                                Действия
                            </div>
                        </section>
                        <section>
                            <div class = "functions_menu">
                                <li class = "active">         
                                    <img src="{{ url_for('static', filename='img/Toplivo.png')}}" alt="">
                                    <a>Топливо</a>   
                                </li>
                                <li >                      
                                    <img src="{{ url_for('static', filename='img/Teplo.png')}}" alt="">
                                    <a>Тепло</a>
                                </li>

                                <li>           
                                    <img src="{{ url_for('static', filename='img/Electro.png')}}" alt="">
                                    <a>Электро</a>   
                                </li>  
                            </div>
                            <div style = "font-weight: 600;">
                                Выбрать раздел
                            </div> 
                        </section>
                        <section>
                            <div class = "functions_menu">                         
                                <li>           
                                    <img src="{{ url_for('static', filename='img/icon_excel.png')}}" alt="">
                                    <a>Экспорт</a>   
                                </li>  
                            </div>
                            <div style = "font-weight: 600;">
                                Экспорт
                            </div>   
                        </section>
                        <section>
                            <div class = "functions_menu">
                                <li>           
                                    <img src="{{ url_for('static', filename='img/.png')}}" alt="">
                                    <a>Вверх</a>   
                                </li> 
                                <li>           
                                    <img src="{{ url_for('static', filename='img/.png')}}" alt="">
                                    <a>Вниз</a>   
                                </li> 
                            </div>
                            <div style = "font-weight: 600;">
                                Сортировка 
                            </div>   
                        </section>

                        <section>
                            <div class = "functions_menu">
                                <li>           
                                    <img src="{{ url_for('static', filename='img/icon_control.png')}}" alt="">
                                    <a>Контроль</a>   
                                </li>  
                            </div>
                            <div style = "font-weight: 600;">
                                Контроль 
                            </div>   
                        </section>
                    </ul>
                </nav>
            </div>
        </div> 
        <div class="report-area_podmenu">
            <input type="radio" id="tab2" name="tab-group">
            <label for="tab2" class="report-area_menu-name">Справка</label> 
            <div class="content-podmenu">
                <nav>
                    <ul>  
                        <section>
                            <div class = "functions_menu">
                                <li id = "myUOM">                     
                                    <img src="{{ url_for('static', filename='img/icon_UOM.png')}}" alt="">
                                    <a>Еденицы измерения</a>
                                </li>
                                <li id = "myTOP">            
                                    <img src="{{ url_for('static', filename='img/icons_TOP.png')}}" alt="">
                                    <a>Виды продукции</a>
                                </li>
                            </div>
                            <div>
                    
                            </div>
                        </section>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    <div class = "report-area">
        <table class = "table_report-area">
            <thead>
                <tr>
                    <th rowspan="2"></th>
                    <th rowspan="2" style = "white-space: nowrap;">Наименование вида продукции(работ услуг)</th>
                    <th rowspan="2" style = "white-space: nowrap;">Код строки</th>
                    <th rowspan="2" style = "white-space: nowrap;">Код по ОКЭД</th>
                    <th rowspan="2">Единица измерения</th>
                    <th rowspan="2">Произведено продукции (работ, услуг) за отчетный период</th>
                    <th colspan="2">Израсходовано на единицу продукции (работы, услуги) за отчетный период, кг у.т.</th>
                    <th colspan="3">Израсходовано на всю произведенную продукцию (работу, услугу) за отчетный период, т у.т.</th>
                    <th rowspan="2">Примечание</th>
                    <th colspan="2"></th>
                </tr>
                <tr>
                    <th>по утвержденной норме (предельному уровню)</th>
                    <th>фактически</th>
                    <th>по утвержденной норме (предельному уровню)</th>
                    <th>фактически</th>
                    <th>Экономия(-), перерасход(+)</th>
                    <th colspan="2"></th>
                </tr>
                <tr>
                    <th></th>
                    <th>A</th>
                    <th>Б</th>
                    <th>В</th>
                    <th>Г</th>
                    <th>1</th>
                    <th>2</th>
                    <th>3</th>
                    <th>4</th>
                    <th>5</th>
                    <th>6</th>
                    <th>7</th>
                    <th colspan="2"></th>
                </tr>
            </thead>
            <tbody>
                {% for row in sections %}
                <tr class = "fuel_row" data-id="{{ row.id }}" >
                    <td>
                        <input type = "hidden" name = "id_fuel" value = "{{ row.id }}" readonly></td>
                    <td>
                        <input class = "product-name_fuel" type = "text" value = "{{ row.product.NameProduct }}" readonly>
                    </td>   
                    <td>
                        <input name = "Oked_fuel" value = "{{ row.code_product }}" readonly>
                    </td>
                    <td>
                        <input name = "Oked_fuel" value = "{{ row.Oked }}" readonly>
                    </td>
                    <td> 
                        <input style = "white-space: nowrap; text-align: left;" name = "" value = "{{ row.product.unit.NameUnit }}" readonly>
                    </td> 
                    <td>
                        <input name = "produced_fuel" value = "{{ row.produced }}" readonly>
                    </td>
                    <td>
                        <input name = "Consumed_Quota_fuel" value = "{{ row.Consumed_Quota }}" readonly>
                    </td>
                    <td>
                        <input name = "Consumed_Fact_fuel" value = "{{ row.Consumed_Fact }}" readonly>
                    </td>
                    <td>
                        <input name = "Consumed_Total_Quota_fuel" value = "{{ row.Consumed_Total_Quota }}" readonly>
                    </td>
                    <td>     
                        <input name = "Consumed_Total_Fact_fuel" value = "{{ row.Consumed_Total_Fact }}" readonly>
                    </td>
                    {% if row.total_differents < 0 or row.total_differents == 0.00%}
                        <td style="background-color: #a2ff77;">
                            <input style="background-color: #a2ff77;" name="" value="{{ row.total_differents }}" readonly>
                        </td>
                    {%else%}
                        <td style="background-color: #ff7676;">
                            <input style="background-color: #ff7676;" name="" value="{{ row.total_differents }}" readonly>
                        </td>
                    {%endif%}
                    <td> 
                        <input name = "note_fuel" value = "{{ row.note }}" readonly>
                    </td>           
                </tr>   
                {%endfor%}
            </tbody>
        </table>        
    </div>
</div>  
<div id="contextmenufuel" class="white-panel">
    <button id = "link_addfuel_modal">
        <span>Добавить</span>
    </button>
    <button id = "link_changefuel_modal">
        <span>Редактировать</span>
    </button>
    <button data-action="">
        <span>Удалить</span>
    </button>
</div>

<div id="changefuel_modal" class="modal">
    <div class="modal-content">
        <div class = "modal-header">
            <h3>Редактирование продукции</h3>
            <a class="close">&times;</a>
        </div>
        <form method="POST" action="/change_fuel">
            <table class="fuel-table_add">
                <tr>
                    <td><span>[A]</span> Наименование вида продукции (работ, услуг)</td>
                    <td>
                        <input type="text" name="product_name" style="width: 400px; text-align: left; color: rgb(132, 132, 132);" autocomplete="off" readonly>
                    </td>
                </tr>
                <tr>
                    <td><span>[B]</span> ОКЭД</td>
                    <td>
                        <input type="text" name="oked" maxlength="5" autocomplete="off" required>
                    </td>
                </tr>
                <tr>
                    <td><span>[1]</span> Произведено продукции (выполнено работ, услуг) за отчетный период</td>
                    <td>
                        <input type="text" name="produced" autocomplete="off">
                    </td>
                </tr>
                <tr>
                    <td><span>[2]</span> Утвержденная норма на единицу продукции</td>
                    <td>
                        <input type="text" name="Consumed_Quota" autocomplete="off">
                    </td>
                </tr>
                <tr>
                    <td><span>[3]</span> Израсходовано на единицу продукции фактически</td>
                    <td>
                        <input type="text" name="Consumed_Fact" style="color: rgb(132, 132, 132);" readonly>
                    </td>
                </tr>
                <tr>
                    <td><span>[4]</span> Израсходовано на всю производственную продукцию по действующей норме</td>
                    <td>
                        <input type="text" name="Consumed_Total_Quota" style="color: rgb(132, 132, 132);" readonly>
                    </td>
                </tr>
                <tr>
                    <td><span>[5]</span> Израсходовано на всю производственную продукцию фактически</td>
                    <td>
                        <input type="text" name="Consumed_Total_Fact" autocomplete="off">
                    </td>
                </tr>
                <tr>
                    <td>Примечание</td>
                    <td>
                        <input style="width: 400px; text-align: left;" type="text" name="note" autocomplete="off">
                        <input type="hidden" id="if_fuel" name="id">
                        <input type="hidden" value="{{ current_version }}" name="current_version">
                    </td>
                </tr>
            </table>
            <button type="submit" class="blue_button fuel-submit">Изменить</button>
        </form> 
    </div>
</div>

<div id="addfuel_modal" class="modal">
    <div class="modal-content">
        <div class = "modal-header">
            <h3>Добавить продукцию</h3>
            <a class="close">&times;</a>
        </div>
        <form method="POST" action="/add_fuel_param">
            <table class = "fuel-table_add">
                <tr>
                    <td><span>[A]</span> Наименование вида продукции (работ, услуг)</td>
                    <td>
                        <input type="text" name="name_of_product" style = "width: 400px; text-align: left;" autocomplete="off">
                        <div class="choose-product_area">
                            <table class = "choose-product_table">
                                <thead>
                                    <tr> 
                                        <th>Код продукта</th>
                                        <th>Наименование продукта</th>
                                        <th>Единица измерения</th>
                                    </tr>
                                </thead>
                                <tbody id="chooseProdTableBody"> 
                                {% for row in dirProduct %}
                                    <tr data-id="{{ row.id }}">
                                        <td>{{row.CodeProduct}}</td>
                                        <td style = " text-align: left;">{{row.NameProduct}}</td>
                                        <td>{{row.unit.NameUnit}}</td>
                                    </tr>
                                    <tr id="noResultsRow" style="display: none;">
                                        <td>Нет результатов</td>        
                                    </tr>
                                {% endfor %}
                                <tbody>  
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td><span>[B]</span> ОКЭД</td>
                    <td>
                        <input                 
                            type="text"
                            name="oked"
                            maxlength="5" 
              
                            autocomplete="off"
                            required
                        >
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>[1]</span> Произведено продукции (выполнено работ, услуг) за отчетный период
                    </td>
                    <td>
                        <input                 
                            type="text"
                            name="produced"
                            value = "0.00"
                            autocomplete="off"
    
                        >
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>[2]</span> Утвержденная норма на единицу продукции
                    </td>
                    <td>
                        <input                 
                            type="text"
                            name="Consumed_Quota"
                            value = "0.00"
                            autocomplete="off"
                        >
                    </td>
                </tr>
                <tr>
                    <td><span>[3]</span> Израсходовано на единицу продукции фактически</td>
                    <td>
                        <input                 
                            type="text"
                            name="Consumed_Fact"
                            value = "0.00"
                            style = "color: rgb(132, 132, 132);"
                            readonly
                        >
                    </td>
                </tr>
                <tr>
                    <td class = ""><span>[4]</span> Израсходовано на всю производственную продукцию по действующей норме</td>
                    <td>
                        <input                 
                            type="text"
                            name="Consumed_Total_Quota"
                            value = "0.00"
                            style = "color: rgb(132, 132, 132);"
                            
                            readonly
                        >
                    </td>
                </tr>
                <tr>
                    <td><span>[5]</span> Израсходовано на всю производственную продукцию фактически</td>
                    <td>
                        <input                 
                            type="text"
                            name="Consumed_Total_Fact"
                            value = "0.00"
                            autocomplete="off"
                        >
                    </td>
                </tr>
                <tr>
                    <td>Примечание</td>
                    <td>
                        <input
                            style = "width: 400px; text-align: left;"          
                            type="text"
                            name="note"
                            autocomplete="off"
                        >
                        <input                 
                            type="hidden"
                            value = "{{current_version}}"
                            name="current_version"
                        >
                    </td>
                </tr>
            </table>    
            <button type = "submit" class = "blue_button fuel-submit">Добавить</button>              
        </form>   
    </div>
</div>



<script>  
    var link_addfuel_modal = document.getElementById('link_addfuel_modal');
    var addfuel_modal = document.getElementById('addfuel_modal'); 
    var close_addfuel_modal = addfuel_modal.querySelector('.close'); 
    link_addfuel_modal.addEventListener('click', function() {
        addfuel_modal.style.display = 'block';
        contextMenu.style.display = 'none';
    });
    close_addfuel_modal.addEventListener('click', function() {
        addfuel_modal.style.display = 'none';
    });
    window.addEventListener('click', function(event) {
        if (event.target == addfuel_modal) {
            addfuel_modal.style.display = 'none';
        }
    });


    var link_changefuel_modal = document.getElementById('link_changefuel_modal');
    var changefuel_modal = document.getElementById('changefuel_modal'); 
    var close_changefuel_modal = changefuel_modal.querySelector('.close'); 
    link_changefuel_modal.addEventListener('click', function() {
        changefuel_modal.style.display = 'block';
        contextMenu.style.display = 'none';
    });
    close_changefuel_modal.addEventListener('click', function() {
        changefuel_modal.style.display = 'none';
    });
    window.addEventListener('click', function(event) {
        if (event.target == changefuel_modal) {
            changefuel_modal.style.display = 'none';
        }
    });


    var nameOfProductInput = document.querySelector('input[name="name_of_product"]');
    var chooseProductArea = document.querySelector('.choose-product_area');
    var chooseProdTableBody = document.getElementById('chooseProdTableBody');
    var noResultsRow = document.getElementById('noResultsRow');
    nameOfProductInput.addEventListener('focus', function() {
        chooseProductArea.style.display = 'block';
    });
    chooseProdTableBody.addEventListener('click', function(event) {
        if (event.target.tagName === 'TD') {
            var productName = event.target.parentNode.querySelector('td:nth-child(2)').textContent;
            nameOfProductInput.value = productName;
            chooseProductArea.style.display = 'none';
        }
    });
    nameOfProductInput.addEventListener('input', function() {
        var filterText = this.value.trim().toLowerCase();
        if (filterText.length > 0) {
            chooseProductArea.style.display = 'block';
        } else {
            chooseProductArea.style.display = 'none';
        }
        var hasResults = false;
        Array.from(chooseProdTableBody.querySelectorAll('tr')).forEach(function(row) {
            var productName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
            if (productName.includes(filterText)) {
                row.style.display = '';
                hasResults = true;
            } else {
                row.style.display = 'none';
            }
        });
        if (!hasResults && filterText.length > 0) {
            noResultsRow.style.display = 'block';
        } else {
            noResultsRow.style.display = 'none';
        }
        document.addEventListener('click', function(event) {
            if (!chooseProductArea.contains(event.target) && event.target !== nameOfProductInput) {
                chooseProductArea.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}